
{{define "media-groups"}}
    <div class="media-groups">
    {{range $i, $group := .Es.Groups}}
        <section class="{{if $group.First.IsBlob}}blob{{else}}tob{{end}}-group">
            {{range $group}}
                {{template "graph-entry" (eLy . $.L false)}}
            {{end}}
        </section>
    {{end}}
    </div>
{{end}}


{{define "graph-entry"}}
    {{if .E.IsBlob}}
        {{template "graph-blob" .}}
    {{else}}
        {{template "graph-tob" .}}
    {{end}}
{{end}}

// blob

{{define "graph-blob"}}
    {{$type := .E.Type}}

    {{if eq $type "image"}}
        {{template "graph-image" .}}
    {{else if eq $type "video"}}
        {{template "video" .}}
    {{else if eq $type "audio"}}
        {{template "audio" .}}
    {{else}}
        Didn’t catch type: {{.}} (graph-blob)
    {{end}}
{{end}}

// tob (text object)

{{define "graph-tob"}}
    {{$type := .E.Type}}

    <article class="graph-tob">
    {{if eq $type "set"}}
        {{template "graph-set" .}}
    {{else if eq $type "text"}}
        {{template "graph-text" .}}
    {{else if eq $type "html"}}
        {{template "html" .}}
    {{else}}
        Didn’t catch type: {{.}} (graph-tob)
    {{end}}
    </article>
{{end}}


{{define "graph-image"}}
    <span class="thumb">
        <a href="{{.E.Perma .L}}">
            {{template "graph-image-thumbnail" .}}
        </a>
    </span>
{{end}}

{{define "graph-text"}}
  <!-- to omit missing translations -->
  {{$text := .E.Text .L}}
  {{if $text}}
  <div class="graph-text">
      {{template "edit-link" .}}
      <div>
          {{$text}}
      </div>
      {{template "graph-date" .}}
  </div>
  {{end}}
{{end}}

{{define "graph-set"}}

<article class="graph-set">
<div>
    {{range $i, $e := .E.Entries}}
        {{template "graph-set-child" (eLy . $.L $.Y)}}
    {{end}}
</div>
{{template "graph-date" .}}
</article>
{{end}}

{{define "graph-set-child"}}
    {{$type := .E.Type}}
    {{if eq "image" $type}}
      <section class="blob-group">
        {{template "graph-image-thumbnail" .}}
      </section>
    {{else if eq "video" $type}}
      <div class="video-main">
        {{template "entry" .}}
      </div>
    {{else}}
      <div class="graph-text">
        <div>
          {{template "entry" .}}
        </div>
      </div>
    {{end}}
    {{template "private-mark-graph" .E}}
{{end}}

{{define "graph-image-thumbnail"}}
    {{/* Title is used, because we **link** to entries. */}}
    {{$alt := .E.Title .L}}

    {{$src := ""}}
    {{$realSrc := .E.ImagePath 320 .L}}
    {{$src = $realSrc}}


    <img src="{{$src}}"
         alt="{{$alt}}"
         srcset="{{template "graph-thumb-srcset" .}}"
         >
{{end}}

{{define "graph-thumb-srcset" -}}
    {{.E.SrcSet 320 .L}}, {{.E.SrcSet 480 .L}}, {{.E.SrcSet 960 .L}}, {{.E.SrcSet 1280 .L}}
{{- end}}
{{/*


    {{/*
    {{if .Lazy}}
      {{$src = .El.PlaceholderPath}}
    {{else}}
      {{$src = $realSrc}}
    {{end}}
    */}}
*/}}
{{/*
{{if .El.Cover}}
    <a href="{{.El.Perma.Lang}}">
    {{template "graph-image-thumbnail" (elArg .El.Cover .Lazy .Lang)}}
    </a>
{{else}}

    <img cthumbilass="{{if .Lazy}} lazy{{end}}"
         src="{{$src}}"
         alt="{{$alt}}"
         {{if .Lazy}}
         data-src="{{$realSrc}}"
         data-srcset="{{- template "graph-thumb-srcset" .}}"
         {{else}}
         srcset="{{template "graph-thumb-srcset" .}}"
         {{end}}
         >

*/}}
