{{define "front"}}
{{template "head" .Head}}

{{template "top" .}}

<main class="margin">

  <h4 class="front-lead">{{var "front-lead" .Head.Lang}}</h4>

  <div></div>

  <div class="cols">
  {{template "index-col" .}}

  {{template "graph-col" .}}

  </div>



</main>

{{template "bot" .Head}}
{{end}}

{{define "index-col" -}}
  <section class="col">
      <div class="front-sep"></div>
      <h3 class="front-section"><a href="/index/">Index</a></h3>
      {{$lang := .Head.Lang}}
      {{range .Index.Offset 0 4}}
      {{template "index-el-front" (elArg . false $lang)}}
      {{end}}
      {{range .Index.Offset 4 15}}
      <div class="desktop">
          {{template "index-el-front" (elArg . false $lang)}}
      </div>
      {{end}}
      <div class="more-tip">
          {{var "index-more" $lang}}
      </div>
  </section>
{{- end}}

{{define "graph-col" -}}
  <section class="col graph-col">
      <div class="front-sep"></div>
      <h3 class="front-section"><a href="/graph/">Graph</a></h3>
      {{template "media-groups-front" (elsArg (.Graph.Offset 0 10) false .Head.Lang)}}
      <div class="more-tip">
      {{var "graph-more" .Head.Lang}}
      </div>
  </section>
{{- end}}

{{define "more-tip"}}
<div class="more-tip">
  {{.}}
</div>
{{end}}

{{define "tip"}}
<div class="tip">
  {{.}}
</div>
{{end}}

{{define "index-el-front"}}
  <article class="text-entry index-el-front">
    {{if eq (elType .El) "image"}}
        <span class="thumb index-thumb">
            <a class="thumbl" href="{{.El.Permalink .Lang}}">
            {{template "graph-image-thumbnail" .}}
            </a>
        </span>
    {{else}}
        {{template "el" .}}
    {{end}}
    {{template "front-index-title" .}}
  </article>
{{end}}

{{define "media-groups-front"}}
    {{$lang := .Lang}}
    {{$total := 0}}
    <div class="media-groups">
    {{range $i, $group := .Els.MediaGroups}}
        {{$type := (elType (index $group 0))}}
      {{if eq $type "image"}}
      <section class="images">
      {{else if eq $type "text"}}
      <section class="texts">
      {{else if eq $type "html"}}
      <section class="texts">
      {{else}}
      <section class="texts">
      {{end}}

        {{range $j, $e := $group}}
            {{$total = add $total 1}}
            {{$forDesktop := (gt $total 6)}}
            {{if $forDesktop}}
            <div class="desktop">
            {{end}}
            {{template "front-main-el" (elArg $e false $lang)}}
            {{if $forDesktop}}
            </div>
            {{end}}
        {{end}}

      </section>
    {{end}}
    </div>

{{end}}

{{define "front-main-el"}}

  {{$type := elType .El}}


    {{if eq $type "image"}}

      <span class="thumb">
        <a class="thumbl" href="{{.El.Permalink .Lang}}">
          {{template "front-image-thumbnail" (elArg .El .Lazy .Lang)}}
        </a>
      </span>

    {{else if eq $type "set"}}

      <span class="thumb">
        {{template "graph-main-set" (elArg .El .Lazy .Lang)}}
      </span>

    {{else if eq $type "text"}}

        <!-- to omit missing translations -->
        {{$text := .El.TextLang .Lang}}
        {{if $text}}
            <article class="text-entry graph-text">
                    <div>
                        {{$text}}
                    </div>
                    {{template "front-date" (elArg .El false .Lang)}}
            </article>
        {{end}}
    {{else if eq $type "audio"}}
        <article>
            {{template "edit-link" (elArg .El false .Lang)}}
            {{template "front-date" (elArg .El false .Lang)}}
            {{template "el" .}}
        <article>
    {{else if eq $type "html"}}
            <article class="text-entry graph-text">
                    <div>
                        {{template "el" .}}
                    </div>
            </article>
    
    {{else}}
        didnt catch: "{{$type}}"
        {{.}}
    {{end}}

{{end}}

{{define "front-image-thumbnail"}}
    <img class="thumbi" src="{{.El.ImagePath 320 .Lang}}"
                        alt="{{.El.Title .Lang}}" 
                        srcset="{{template "front-thumb-srcset" .}}">
    {{/* sizes="17rem" */}}
{{end}}

{{define "front-thumb-srcset" -}}
{{.El.SrcSet 320 .Lang}}, {{.El.SrcSet 480 .Lang}}, {{.El.SrcSet 640 .Lang}}
{{- end}}

{{define "front-date"}}
<header class="front-meta">
    <a class="" href="{{.El.Permalink .Lang}}">
        {{.El.Date.Format "2<span class=\"ddot\">.</span> 1<span class=\"ddot\">.</span>"}}
    </a>
</header>
{{template "edit-link" (elArg .El false .Lang)}}
{{end}}

{{define "front-index-title"}}
<header class="front-meta">
    {{with (.El.File.Hold.Link .Lang)}}
    <a class="topicl" href="{{.Slug}}">{{removeß .Title}}</a> 
    {{end}}
</header>
    {{template "edit-link" .}}
{{end}}

{{define "index-title-front"}}
    {{$title := .El.Info.Title .Lang}}
    {{if $title}}
    <a class="title-below black" href="{{.El.Permalink .Lang}}">{{$title}}</a>
    {{end}}
{{end}}

{{define "edit-link-hold"}}
    {{if isLocal}}
    {{$x := .Hold.File.Rel}}
    <a class="editl" href="http://org/public{{$x}}" target="_blank">※</a>
    {{end}}
{{end}}

{{define "edit-link"}}
    {{if isLocal}}
    {{$x := filepathDir .El.File.Rel}}
    <a class="editl" href="http://org/public{{$x}}#{{.El.File.Base}}" target="_blank">※</a>
    {{end}}
{{end}}


{{define "date"}}
    <div class="date margin">
        <a href="{{.Permalink}}">
    {{.Date.Format "2. Jan 15:04"}}
        </a>
    </div>
{{end}}


{{define "set-els"}}
{{$lang := .Lang}}
{{range $i, $e := .El.Els}}
{{$type := elType $e}}
    {{if eq $type "image"}}
    <div class="img-limiter margin">
    {{end}}
    {{template "el" (elArg $e $lang)}}
    {{if eq $type "image"}}
    </div>
    {{end}}
{{end}}
{{end}}


{{define "changelog"}}
{{$lang := .Lang}}
{{with .El}}
    <section>
        <h3 id="changelog"><a href="/changelog">Changelog</a></h3>
        <ul class="changelog">
            {{range .}}
            <li>
                <span class="modtime mono small">
                {{.ModTime.Format "02.01.06"}}
                </span>
                <span class="changelog-title">
                <a href="{{index .TitleHref $lang}}">
                {{index .Title $lang}}
                </a>
                </span>
                <a class="topic-front blackl" href="{{index .HoldHref $lang}}">
                    {{index .HoldName $lang}}
                </a>
            </li>
            {{end}}
        </ul>
    </section>
{{end}}
{{end}}
